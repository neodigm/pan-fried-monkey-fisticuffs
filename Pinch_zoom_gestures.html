<!DOCTYPE html>
<html lang=en>
<head>
  <title>Neodigm | Pointer Events pinch/zoom pattern</title>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1, maximum-scale=2, minimum-scale=1, width=device-width, height=device-height"/>
</head>

<body>

  <section style="touch-action:none"
  data-panzoom="true">
    <img src="https://www.ltdcommodities.com/images/product/90323_1324569_WOY_zm1.jpg">
  </section>
 <hr>
  <section style="touch-action:none"
  data-panzoom="true">
    <img src="https://www.ltdcommodities.com/images/product/90323_1324569_WOY_zm.jpg">
  </section>
<hr>

<script>
let fPanZ = ((_d)=>{
  let aElem = []; // Elements
  let nXYdiff = -1;
  return {
    "init": (sQuery)=>{
      let aTarg = _d.querySelectorAll( sQuery );
      aTarg.forEach( ( eTarg )=>{
        let eImg = eTarg.querySelector( "img" );
        eTarg.aEv = [];
        aElem.push( eTarg );
        eTarg.onpointerdown = fPanZ.pointDown;
        eTarg.onpointermove = fPanZ.pointMove;
          eTarg.onpointerup     = fPanZ.pointUp;
          eTarg.onpointercancel = fPanZ.pointUp;
          eTarg.onpointerout    = fPanZ.pointUp;
          eTarg.onpointerleave  = fPanZ.pointUp;
      });
      return ( aTarg.length !== 0 );
    },
    "pointDown": function(ev){ this.aEv.push( ev ); },
    "pointMove": function(ev){
console.log("ducks | " + this.aEv.length);
      this.aEv = this.aEv.map(function( _ev ){ // Update Event
        if( _ev.pointerId === ev.pointerId ) _ev = ev; return true;
      });

      if( this.aEv.length == 2) { // Distance between two pointers
        var nXYnew = Math.abs(this.aEv[0].clientX - this.aEv[1].clientX);
        if( nXYdiff > 0) {
          if( nXYnew > nXYdiff) { // Zoom In
    console.log("Pinch moving OUT -> Zoom in", ev);
            fPanZ.doZoomIn();
          }
          if( nXYnew < nXYdiff) { // Zoom Out
    console.log("Pinch moving IN -> Zoom out",ev);
            fPanZ.doZoomOut();
          }
        }
        nXYdiff = nXYnew;
      }
     },
    "pointUp":   function(ev){
      this.aEv = this.aEv.filter(function( _ev ){ return ( _ev.pointerId !== ev.pointerId ); });
      if( this.aEv.length < 2 ) nXYdiff = -1; // reset
     },
     "doZoomIn": function(){
       alert("In");
     },
     "doZoomOut": function(){
       alert("Out");
     }
  };
})( document );

fPanZ.init("[data-panzoom]");

</script>

<style>
  [data-panzoom] {width: 44%;margin: 8px auto;}
  [data-panzoom] img {width: 100%}
</style>
</body>
</html>
